<!DOCTYPE html>
<html>
  <head>
    <title>CFA: Team Salt Lake Q1 Report</title>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,900,300" rel="stylesheet" type='text/css'>
    <link href="dep.css" rel="stylesheet" type='text/css'>
    <script src="dep.js"></script>

  </head>

  <style type="text/css">
    svg {
      margin-top: 75px;
    }
    .dropdown {
      float: left;
      min-width: 150px;
    }
    .dropdown-content {
      min-width: 150px; 
    }
  </style>

  <body>

    <div class="dropdown">
      <span id="arch-name">Archetype Filters</span>
      <div class="dropdown-content" id="arch-dd">
      </div>
    </div>

    <div class="dropdown" style="left: 175px">
      <span id="sub-name">Archetype Filters</span>
      <div class="dropdown-content" id="sub-dd">
      </div>
    </div>

    <div class="title">User Research <b>Attribute Distributions</b></div>
    <a class="back-btn" href="../index.html">Back</a>
    <div id="chart"></div>
  </body>

  <script type="text/javascript">
    // globals
    var margin, width, height, x, y, svg;
    var baseData = null;
    var opts = {};
    

    $.getJSON("ss-snapshot.js", function (d) { loadData(d); });
    setUpView();

    function loadData (d) {
      baseData = d;
      Object.keys(d[0]).forEach(function (ea) {
        ea = ea.split("_");
        if (ea[0] !== "excercise" && ea[0] !== "descriptor") {
          if (!opts[ea[0]]) {
            opts[ea[0]] = []; 
            $("#arch-dd").append("<p onclick='generateData(\"" + String(ea[0]) + "\", null)'>" + cleanName(String(ea[0])) + "</p>");
          }
          if (opts[ea[0]].indexOf(ea[1]) == -1) opts[ea[0]].push(ea[1]);
        }
      });
      generateData("schedule", "conflicts");
    }

    function generateData (arch, sub) {
      $("#arch-name").text(cleanName(arch));
      if (sub) $("#sub-name").text(cleanName(sub));
      else $("#sub-name").text("Select a Sub-paramater");
      $("#sub-dd").empty();

      var newSubOpts = [];
      var newData = {};
      baseData.map(function (ea) {
        var keys = Object.keys(ea);
        keys = keys.filter(function (k) {
          var ok = false;
          k = k.split("_");
          if (k[0] == arch) {
            if (newSubOpts.indexOf(k[1]) == -1) {
              if (k[1] !== "quote" && k[1] !== "keys" && k[1] !== "names") {
                newSubOpts.push(k[1]);
                $("#sub-dd").append("<p onclick='generateData(\"" + String(k[0]) + "\", \"" + String(k[1]) + "\")'>" + cleanName(String(k[1])) + "</p>");
              }
            }

            if (sub) { if (k[1] == sub) ok = true; }
            else { ok = true; }
          }
          return ok;
        });
        keys.forEach(function (k) {
          k2 = k.split("_")[2];
          if (k2 !== "esttimesthroughsys") {
            if (!newData[k2]) newData[k2] = 0;
            if (!isNaN(Number(ea[k]))) newData[k2] += Number(ea[k]);
          }
        });
      });

      if (newSubOpts.length == 1) $("#sub-name").text(cleanName(newSubOpts[0]));

      var reconfigured = [];
      for (var v in newData) {
        if (newData[v] > 0) {
          reconfigured.push({
            xval: v,
            yval: Math.round(newData[v]/2)
          })
        }
      };
      draw(reconfigured);
    }

    function setUpView () {
      margin = {top: 20, right: 20, bottom: 70, left: 40};
      width = window.innerWidth - margin.left - margin.right;
      height = window.innerHeight - 125 - margin.top - margin.bottom;
      x = d3.scale.ordinal().rangeRoundBands([0, width], .05);
      y = d3.scale.linear().range([height, 0]);

      xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

      yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(10);

      svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", 
              "translate(" + margin.left + "," + margin.top + ")");
    };

    function draw (data) {
      // clear any existing if exist
      try { $("svg").remove(); setUpView(); } catch (e) { };

      var tot = 0;
      data.forEach(function (d) { tot += d.yval });
      if (tot < 23) tot = 23;

      data.forEach(function (d) {
        d.xval = cleanName(d.xval);
        d.yval = Math.round(d.yval/tot * 100);;
      });
    
      x.domain(data.map(function (d) { return d.xval; }));
      y.domain([0, 100]);

      svg.append("g")
        .attr("class", "x axis")
        .attr("fill", "white")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
      .selectAll("text")
        .style("text-anchor", "middle")
        .attr("fill", "white")
        .attr("y", function (d, i) { return "-" + (data[i].yval * 0.9 + 3) + "%"; })
        // .attr("dy", "1em");

      svg.append("g")
        .attr("class", "y axis")
        .attr("fill", "white")
        .call(yAxis)
      .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Percentage (%)");

      svg.selectAll("bar")
        .data(data)
      .enter().append("rect")
        .style("fill", "#7ab5d6")
        .on("mouseover", function (d) { d3.select(this).style("fill", "orange"); })
        .on("mouseout", function (d) { d3.select(this).style("fill", "#7ab5d6"); })
        .attr("x", function(d) { return x(d.xval); })
        .attr("width", x.rangeBand())
        .attr("y", function(d) { return y(d.yval); })
        .attr("height", function(d) { return height - y(d.yval); });

    };

    function cleanName (n) {
      n = String(n);

      if (n == "attitude") { return "Attitudes"; }
      if (n == "familyfriends") { return "Family, Friends"; }
      if (n == "status") { return "Status"; }
      if (n == "cjs") { return "CJS Relationship"; }
      if (n == "personal") { return "Health and Personal Issues"; }
      if (n == "demographics") { return "Demographics"; }
      if (n == "technology") { return "Technology"; }
      if (n == "schedule") { return "Scheduling"; }
      if (n == "users") { return "Working Towards"; }
      if (n == "fta") { return "Failure-To-Appears"; }

      if (n == "female") { return "Female"; }
      if (n == "male") { return "Male"; }

      if (n == "probation") { return "Probation"; }
      if (n == "pretrial") { return "Pretrial"; }

      if (n == "fearful") { return "Fearful"; }
      if (n == "respectful") { return "Respectful"; }
      if (n == "resigned") { return "Resigned"; }
      if (n == "indifferent") { return "Indifferent"; }
      if (n == "optimistic") { return "Optimistic"; }
      if (n == "blamessys") { return "Blames the System"; }
      if (n == "angry") { return "Angry"; }
      if (n == "understandsreqs") { return "Understands Requirements"; }
      if (n == "confused") { return "Confused"; }
      if (n == "overwhelmed") { return "Overwhelmed"; }
      if (n == "neveragain") { return "Used Phrase 'Never Again'"; }

      if (n == "calculatedintent") { return "Calculated Intent"; }
      if (n == "drugsalcohol") { return "Drugs and Alcohol"; }
      if (n == "mentalissues") { return "Mental Issues"; }
      if (n == "physicalissues") { return "Physical Issues"; }
      if (n == "pasttrauma") { return "Past Trauma"; }
      if (n == "sobercleanrecovery") { return "Sober Clean Recovery"; }
      if (n == "ownssmartphone") { return "Owns a Smartphone"; }
      if (n == "ios") { return "iOS"; }
      if (n == "savvy") { return "Considered 'Tech Savvy'"; }
      if (n == "feepayment") { return "Fee Payment"; }
      if (n == "pastanklemonitor") { return "Has/had Ankle Monitor"; }
      if (n == "multiplecases") { return "Multiple Concurrent Cases"; }
      if (n == "multipletimesthroughsystem") { return "Multiple Times Through System"; }
      if (n == "recdrugsalcohol") { return "Recreational Drug or Alcohol Use"; }
      if (n == "dcfs") { return "Has 2nd Case Manager with DCFS"; }
      if (n == "childsupport") { return "Child Support"; }
      if (n == "infostercare") { return "Has Child in Foster Care"; }
      if (n == "haschildren") { return "Has Children"; }
      if (n == "livingsituation") { return "Living Situation"; }
      if (n == "withfamily") { return "Lives with Family"; }
      if (n == "hasconflicts") { return "Has Conflicts"; }
      if (n == "overscheduled") { return "Over Scheduled"; }
      if (n == "competingsupervisionreqs") { return "Competing Supervision Requirements"; }
      if (n == "quietcompletion") { return "Quiet Supervision Completion"; }
      if (n == "socialties") { return "Social Ties"; }
      if (n == "family") { return "Reunite with Family"; }

      else { 
        n = n[0].toUpperCase() + n.slice(1, n.length)
        return n; 
      }
    };

  </script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77005200-1', 'auto');
  ga('send', 'pageview');

</script>
</html>



